<?xml version="1.0"?>

<launch>
    <arg name="robot_type" default="$(env ROBOT_TYPE)" doc="Robot type: [a1, aliengo, go1, laikago]" />
    <arg name="cheater" default="false" />
    <arg name="spawner" default="false" />
    <arg name="legged_pub" default="false" /> <!-- Load comm to controller -->

    <arg name="urdfFile" default="/tmp/legged_control/$(arg robot_type).urdf" />
    <arg name="taskFile" default="$(find legged_controllers)/config/$(arg robot_type)/task.info" />
    <arg name="referenceFile"
        default="$(find legged_controllers)/config/$(arg robot_type)/reference.info" />
    <arg name="gaitCommandFile"
        default="$(find legged_controllers)/config/$(arg robot_type)/gait.info" />

    <!-- make the files into global parameters -->
    <!-- <param name="urdfFile" value="/tmp/legged_control/$(arg robot_type).urdf" />
    <param name="taskFile" value="$(find legged_controllers)/config/$(arg robot_type)/task.info" />
    <param name="referenceFile"
        value="$(find legged_controllers)/config/$(arg robot_type)/reference.info" />
    <param name="gaitCommandFile"
        value="$(find legged_controllers)/config/$(arg robot_type)/gait.info" /> -->

    <param name="urdfFile" value="$(arg urdfFile)" type="str" />
    <param name="taskFile" value="$(arg taskFile)" type="str" />
    <param name="referenceFile"
        value="$(arg referenceFile)" type="str" />
    <param name="gaitCommandFile"
        value="$(arg gaitCommandFile)" type="str" />


    <rosparam file="$(find legged_controllers)/config/controllers.yaml" command="load" />

    <!-- Use spawner to load controller, automatically loads & initialize controller -->
    <group if="$(arg spawner)">
        <node if="$(arg cheater)" name="controller_manager" pkg="controller_manager"
            type="spawner"
            output="screen"
            args="
                  controllers/joint_state_controller
                  controllers/legged_controller
                  controllers/legged_cheater_controller" />

        <node unless="$(arg cheater)" name="controller_manager" pkg="controller_manager"
            type="spawner"
            output="screen"
            args="
                  controllers/joint_state_controller
                  controllers/legged_controller" />
    </group>

    <!-- Use controller manager to load controller -->
    <group unless="$(arg spawner)">
        <node if="$(arg cheater)" name="controller_loader" pkg="controller_manager"
            type="controller_manager"
            output="screen"
            args="load
            controllers/joint_state_controller
            controllers/legged_controller
            controllers/legged_cheater_controller" />

        <node unless="$(arg cheater)" name="controller_loader" pkg="controller_manager"
            type="controller_manager"
            output="screen"
            args="load
                  controllers/joint_state_controller
                  controllers/legged_controller" />
    </group>

    <node pkg="ocs2_legged_robot_ros" type="legged_robot_gait_command"
        name="legged_robot_gait_command"
        output="screen" launch-prefix="gnome-terminal --" />

    <group if="$(arg legged_pub)">
        <node pkg="legged_controllers" type="legged_target_trajectories_publisher"
            name="legged_robot_target"
            output="screen" />
    </group>
</launch>